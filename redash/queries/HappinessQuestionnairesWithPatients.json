{
  "collection": "happinessquestionnaires",
  "aggregate": [
    {
      "$addFields": {
        "shortPatientId": {
          "$substr": [
            "$patientId",
            0,
            5
          ]
        }
      }
    },
    {
      "$lookup": {
        "from": "patients",
        "localField": "patientId",
        "foreignField": "_id",
        "as": "patient"
      }
    }
  ]
}