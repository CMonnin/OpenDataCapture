---
title: Instruments
slug: en/concepts/instruments
sidebar:
  order: 3
---

### What is an Instrument?

Central to Open Data Capture is the concept of an instrument. Conceptually, an instrument is any tool that can be used to collect data. This can range from simple forms (e.g., a questionnaire assessing depressive symptoms) to complex interactive tasks (e.g., the Stroop Task).

Technically, an _Instrument_ is a just a [JavaScript Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object), which is composed of a key-value pairs, similar to a dictionary in Python. These objects define the properties of an instrument, such as the content to be displayed by the user (e.g., the fields of a form).

### Instrument Bundle (I)

In Open Data Capture, Instruments are almost always generated from an _Instrument Bundle_. An Instrument Bundle is [JavaScript expression](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Expressions_and_Operators) that resolves to a [Promise](https://developer.mozilla.org/en-US/docs/Web/J) of an Instrument. For example, supposing that an Instrument included only a name, the following would be an example of an Instrument Bundle:

```javascript
const instrumentBundle = "Promise.resolve({ name: 'Simplified Instrument' });";
const instrument = await eval(instrumentBundle);
console.log(instrument.name); // 'Simplified Instrument'
```

### Instrument Sources

In practice, these bundles are seldom written directly by end users. Instead, they are generated by the _Bundler_ from _Instrument Sources_, which are the files that define an instrument. These files are stored in a directory, which must include an index file. This serves as the entry point for the instrument and must include a default export that defines the instrument

To resolve the index file, the bundler checks for the following file names (in order):

- `index.tsx`
- `index.jsx`
- `index.ts`
- `index.js`

If none of these files exist, the Bundler throws an exception.

In many cases, _Instrument Sources_ may include one an index file. For example, if we convert the previous example to _Instrument Sources_:

**index.js**

```javascript
export default Promise.resolve({ name: 'Simplified Instrument' });
```

### Instrument Bundle (II)

From these sources, the Bundler generates a single asynchronous [Immediately Invoked Function Expression](https://developer.mozilla.org/en-US/docs/Glossary/IIFE). This output conforms to the [ECMAScript 2022 Language Specification](https://262.ecma-international.org/13.0/) and can be executed in any modern browser.

For example, the Bundler might generate the following output:

```javascript
"(async () => ({ name: 'Simplified Instrument' }))();";
```

### Form Instrument Structure

An Open Data Capture form instrument (i.e., the object that is the default export from the index source file) consists of several properties that together define the data and display model. By convention, these properties should be sorted in the order in which they are documented below (e.g., `kind` should be the first property, followed by `language`).

- `kind`
- `language`
- `internal`
- `internal.name`
  - The name of the instrument must be unique and should be the full name of the instrument in camel case with uppercase letters. This is to indicate that this is for internal use only. The title, on the other hand, should be a human readable format in title case (if applicable in the language), similar to what one would see on the title of a paper version. This is what is displayed to the user.
  - Also, common short form, if it exists, should be in brackets after (e.g., MAF) and should be the same in French and English (no translation unless there is a common french translation of the short form).
- `internal.edition`
- `tags`
- `details`
  - The details contains user-facing metadata about the instrument (i.e., the information shown for the initial overview of an instrument).
- `details.title`
- `details.description`
- `content`
  - The form items (the content object) defines the content shown on the “content” page when completing an instrument (i.e., the fields used to uptake data).
- `content.kind`
- `content.variant`
- `measures`
  - These are the outcomes of the instrument that are of relevance to users. In some cases, this may simply be a reference to fields in the instrument, or a computed value.
  - Defines how raw data is displayed on the ODC frontend, such as in tables and graphs.
  - Determines the summary page.
  - Also included in data export.
- `validationSchema`
  - This defines the data model for the form, and corresponds one-to-one with the data structure that is ultimately stored in the database. As such, **this is the most important part of the form definition**, and should be defined before any fields.

Always consider using \`group\`ing to structure sections

### Best Practices

1. Name the directory and files and name in a long-form way to indicate what it is, prefix it with the PROJECT NAME only if the form is unique to the project.
2. Name the output variables for the forms appropriately given the question and answer being provided.
   - Remember that they will be prefixed with the form name when eventually dumped
3. Consider the appropriate encoding for the data
   - Is there a clear order of the values? If so, consider doing an ordered enum.
4. Test your inputs against the validation schema
   - Make sure your rules are correct given the paper form
   - Please familiarize yourself with the possible validation rules here
   - Be careful to write the most restrictive validation schema possible
     - Example: likert-scale data should be .int()
     - Remember the API data-entry is independent of the form, so the validation schema must properly restrict API entry as well
5. Please make sure to format your code whenever possible, as this can prevent annoying issues with missing brackets. In the playground, you can do this with (Alt + F)
6. If you find yourself repeating code frequently, consider extracting the logic into shared variables. The guiding principle of this should be to maximize readability.
   - For example, if your data schema is z.number().int().min(0).max(7) for every field, consider moving it into a variable, as this can reduce the cognitive load of programmers reading your form
   - On the other hand, if this is the schema for only two or three variables, creating a variable would probably increase cognitive load, rather than reducing it.
   - The same applies for computed measures (i.e., define a function at the top of your file instead of copy-pasting it to every field).
7. Review common styling conventions
   - https://google.github.io/styleguide/jsguide.html
8. Use [the playground](https://playground.opendatacapture.org/) to create instruments
   - It is updated regularly to use the latest runtime
   - It is setup with formatting, linting, and type checking by default

### Example Form

```js
const { defineInstrument } = await import('/runtime/v1/opendatacapture@1.0.0/core.js');
const { z } = await import('/runtime/v1/zod@3.23.6/index.js');

export default defineInstrument({
  kind: 'FORM',
  language: ['en', 'fr'],
  internal: {
    name: 'HAPPINESS_QUESTIONNAIRE',
    edition: 1
  },
  tags: {
    en: ['Well-Being'],
    fr: ['Bien-être']
  },
  details: {
    description: {
      en: 'The Happiness Questionnaire is a questionnaire about happiness.',
      fr: 'Le questionnaire sur le bonheur est un questionnaire sur le bonheur.'
    },
    estimatedDuration: 1,
    instructions: {
      en: ['Please answer the questions based on your current feelings.'],
      fr: ['Veuillez répondre àux questions en fonction de vos sentiments actuels.']
    },
    license: 'AGPL-3.0',
    title: {
      en: 'Happiness Questionnaire',
      fr: 'Questionnaire sur le bonheur'
    }
  },
  content: {
    overallHappiness: {
      description: {
        en: 'Please select a number from 1 to 10 (inclusive), where 1 is very dissatisfied and 10 is very satisfied.',
        fr: 'Veuillez choisir un chiffre de 1 à 10 (inclus), où 1 correspond à très insatisfait et 10 à très satisfait.'
      },
      kind: 'number',
      label: {
        en: 'How happy are you?',
        fr: 'Quel est votre niveau de bonheur ?'
      },
      max: 10,
      min: 1,
      variant: 'slider'
    }
  },
  measures: {
    overallHappiness: {
      kind: 'const',
      ref: 'overallHappiness'
    }
  },
  validationSchema: z.object({
    overallHappiness: z.number().int().min(1).max(10)
  })
});
```
